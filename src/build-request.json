{
  "kind": "build_request",
  "title": "Replace phone number authentication with 6-character ID system",
  "projectName": "Digital Gaming Marketplace",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Remove all phone number collection and validation logic from the authentication flow, including PhoneNumberSetup component and phone number storage in user profiles",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2"
        ],
        "quotes": [
          "Login and authentication switch it with ids",
          "Remove phone number requirement"
        ]
      },
      "acceptanceCriteria": [
        "PhoneNumberSetup component is no longer called during authentication",
        "Backend user profile no longer stores or requires phoneNumber field",
        "Users can complete authentication without providing a phone number"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement 6-character alphanumeric ID system where new users are automatically assigned a unique 6-character ID (letters and numbers) upon first login if they don't have one",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "on top make them get and id if they don't have one",
          "Get an auto-generated 6-character ID if they don't have one"
        ]
      },
      "acceptanceCriteria": [
        "Backend generates unique 6-character alphanumeric IDs (e.g., A3B2C1, X7Y9Z4)",
        "IDs are collision-resistant and guaranteed unique",
        "New users automatically receive an ID on profile creation",
        "Existing users without IDs are migrated to have 6-character IDs"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Create ID claim/creation dialog that appears for new users on first login, allowing them to either accept their auto-generated 6-character ID or create a custom 6-character ID for free",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "make a custom one for free that's 6 letters long",
          "Prompt new users to claim/create their ID on first login"
        ]
      },
      "acceptanceCriteria": [
        "Dialog appears automatically for users without an ID after Internet Identity login",
        "Users can see their auto-generated 6-character ID",
        "Users can choose to create a custom 6-character alphanumeric ID",
        "Custom ID input validates for exactly 6 characters (letters and numbers only)",
        "Custom ID creation checks for uniqueness before acceptance",
        "Dialog cannot be dismissed until an ID is claimed or created"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Update user profile storage to use 6-character IDs as the primary identifier, replacing the current PUR-XXXXXX format userId with the new 6-character format",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "that's 6 letters long",
          "unique 6-character ID"
        ]
      },
      "acceptanceCriteria": [
        "User profiles store IDs in 6-character format (no prefix)",
        "Backend validates ID format is exactly 6 alphanumeric characters",
        "Migration handles conversion from old PUR-XXXXXX format to new format"
      ]
    },
    {
      "id": "REQ-5",
      "text": "Update all frontend displays that show user IDs to use the new 6-character format, including profile display, layout header, and any admin panels",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "switch it with ids"
        ]
      },
      "acceptanceCriteria": [
        "User IDs display in 6-character format throughout the application",
        "Layout header shows 6-character ID in parentheses next to username",
        "Profile pages display 6-character IDs correctly",
        "Admin panels show 6-character IDs for user identification"
      ]
    },
    {
      "id": "REQ-6",
      "text": "Remove phone number admin whitelist functionality and any phone number-related admin controls from the admin panel",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2"
        ],
        "quotes": [
          "Remove phone number requirement"
        ]
      },
      "acceptanceCriteria": [
        "Admin panel no longer includes phone number whitelist management",
        "Backend removes phone number whitelist storage and validation",
        "Payment configuration form removes phone number admin fields"
      ]
    },
    {
      "id": "REQ-7",
      "text": "Keep Internet Identity authentication system unchanged as the primary login method, with users authenticating via passkeys, Google, Apple, or Microsoft",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "Do you want to keep Internet Identity authentication?\" - \"Yes"
        ]
      },
      "acceptanceCriteria": [
        "Internet Identity login flow remains functional",
        "Users can still authenticate with passkeys and federated identity providers",
        "Authentication state management continues to work with existing hooks"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor backend architecture with all logic in backend/main.mo",
    "Do not modify immutable frontend paths: useInternetIdentity hooks, useActor.ts, main.tsx, and components/ui",
    "Keep Internet Identity as the sole authentication provider",
    "Preserve existing shopping cart, product, and payment functionality"
  ],
  "nonGoals": [
    "Adding new authentication providers beyond Internet Identity",
    "Implementing phone number verification or SMS features",
    "Creating username regeneration with payment (already exists)",
    "Modifying the queue skip or custom username purchase flows",
    "Adding backend support for Rust, databases, or external services"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}